<script>
  const params = new URLSearchParams(window.location.search);
  const petId = params.get("petId") || "Unknown";
  const petName = params.get("petName") || "Pet";
  document.getElementById("heading").textContent = `Vote for ${petName}`;

  document.getElementById("submitBtn").addEventListener("click", () => {
    const qtyInput = document.getElementById("voteQty");
    const quantity = parseInt(qtyInput.value, 10) || 1;

    document.getElementById("paypal-button-container").innerHTML = "";
    document.getElementById("paypal-button-container").style.display = "block";

    paypal.Buttons({
      createOrder: (data, actions) => {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: (quantity * 1.00).toFixed(2)
            },
            custom_id: petId,
            description: `Vote for ${petName}`,
            quantity
          }]
        });
      },
      onApprove: (data, actions) => {
        return actions.order.capture().then(() => {
          // Show thank you message
          document.getElementById("wrapper").innerHTML = `
            <h2> Thank you for voting!</h2>
            <h3> Your support of Big Dogs Don't Cry Saves lives! <h3>
            <p>You can now close this window.</p>
            <p>Closing in <span id="countdown">30</span> seconds...</p>
          `;

          let seconds = 30;
          const countdownEl = document.getElementById("countdown");

          const interval = setInterval(() => {
            seconds--;
            countdownEl.textContent = seconds;
            if (seconds === 0) {
              clearInterval(interval);
              window.close();
            }
          }, 1000);

          // Also notify Wix parent frame if still needed
          window.parent.postMessage("vote-complete", "*");
        });
      }
    }).render("#paypal-button-container");
  });
</script>
